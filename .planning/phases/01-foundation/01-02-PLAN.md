---
phase: 01-foundation
plan: "02"
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - src/app/(auth)/login/page.tsx
  - src/app/(auth)/signup/page.tsx
  - src/app/(auth)/layout.tsx
  - src/lib/auth.ts
  - src/lib/types.ts
  - src/hooks/useAuth.ts
  - src/components/layout/Navbar.tsx
autonomous: true
requirements:
  - AUTH-01
  - AUTH-02
  - AUTH-03

must_haves:
  truths:
    - "A user can sign up with email and a password and see a success state"
    - "A user can log in with email and password and be redirected to /feed (placeholder)"
    - "After a browser refresh, a logged-in user remains logged in (session persists via localStorage)"
    - "A logged-in user can click Log Out from the Navbar and be returned to /login"
    - "All auth screens use Japandi Calm Tech tokens (washi neutrals, sage accent, Cormorant header)"
    - "Google and Apple sign-in buttons appear in the UI (disabled/UI-only for prototype)"
  artifacts:
    - path: "src/lib/auth.ts"
      provides: "localStorage-based auth: signUp, signIn, signOut, getCurrentUser, isAuthenticated"
      exports: ["signUp", "signIn", "signOut", "getCurrentUser", "isAuthenticated"]
    - path: "src/lib/types.ts"
      provides: "UserProfile type matching cultx:user localStorage shape"
      exports: ["UserProfile", "AuthUser"]
    - path: "src/app/(auth)/login/page.tsx"
      provides: "Login screen with email/password form and Google/Apple UI buttons"
      exports: ["default"]
    - path: "src/app/(auth)/signup/page.tsx"
      provides: "Signup screen with email/password form and Google/Apple UI buttons"
      exports: ["default"]
    - path: "src/hooks/useAuth.ts"
      provides: "React hook returning { user, isLoggedIn, signOut } with localStorage sync"
      exports: ["useAuth"]
  key_links:
    - from: "src/app/(auth)/login/page.tsx"
      to: "src/lib/auth.ts"
      via: "signIn call on form submit"
      pattern: "signIn\\("
    - from: "src/lib/auth.ts"
      to: "localStorage"
      via: "localStorage.setItem('cultx:user', ...)"
      pattern: "localStorage\\.setItem.*cultx:user"
    - from: "src/components/layout/Navbar.tsx"
      to: "src/hooks/useAuth.ts"
      via: "useAuth hook to show logout button when logged in"
      pattern: "useAuth\\("
---

<objective>
Implement the authentication screens (P01) and localStorage-based session management. Users can sign up, log in, and log out. Session persists across browser refreshes. Google and Apple sign-in appear as UI-only buttons (prototype — no OAuth).

Purpose: Auth is the gate to the rest of the app. Every subsequent phase needs a logged-in user with a profile in localStorage.
Output: Working auth flow with session persistence. Navbar updated to show logout. UserProfile type established for onboarding (Plan 03).
</objective>

<execution_context>
@/Users/jccruzb-local/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jccruzb-local/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@claude.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Auth logic — localStorage session, UserProfile type, useAuth hook</name>
  <files>
    src/lib/types.ts
    src/lib/auth.ts
    src/hooks/useAuth.ts
  </files>
  <action>
This is a local-first prototype. Auth is simulated using localStorage — no real backend or OAuth. Google/Apple buttons are UI-only placeholders.

1. Create `src/lib/types.ts` with the full UserProfile type matching the localStorage schema defined in claude.md:

```ts
export interface UserProfile {
  userId: string;
  isLoggedIn: boolean;
  email: string;
  displayName?: string;
  interests: string[];
  profileType: "General audience" | "Student" | "Academic" | "Cultural professional" | null;
  region: "North" | "Central" | "South" | "West" | "Peninsula" | null;
  explorationMode: "My region" | "Entire Mexico" | "Both" | null;
  onboardingComplete: boolean;
  newsletter: { enabled: boolean; frequency: "weekly" | "biweekly" };
  aiDepth: "standard" | "academic";
}

export interface AuthUser {
  userId: string;
  email: string;
  displayName?: string;
}
```

2. Create `src/lib/auth.ts`:

```ts
import { LOCAL_STORAGE_KEYS } from "@/lib/constants";
import type { UserProfile, AuthUser } from "@/lib/types";

function generateUserId(): string {
  return `user_${Date.now()}_${Math.random().toString(36).slice(2, 9)}`;
}

export function signUp(email: string, password: string, displayName?: string): AuthUser {
  // Prototype: store minimal auth. Password not hashed (prototype only).
  // In production this would be a real API call.
  const userId = generateUserId();
  const profile: UserProfile = {
    userId,
    isLoggedIn: true,
    email,
    displayName,
    interests: [],
    profileType: null,
    region: null,
    explorationMode: null,
    onboardingComplete: false,
    newsletter: { enabled: false, frequency: "weekly" },
    aiDepth: "standard",
  };
  if (typeof window !== "undefined") {
    localStorage.setItem(LOCAL_STORAGE_KEYS.USER, JSON.stringify(profile));
  }
  return { userId, email, displayName };
}

export function signIn(email: string, _password: string): AuthUser | null {
  // Prototype: accept any credentials and return/create a user session.
  // Check if a user already exists for this email; if so restore their profile.
  if (typeof window === "undefined") return null;
  const stored = localStorage.getItem(LOCAL_STORAGE_KEYS.USER);
  if (stored) {
    const profile: UserProfile = JSON.parse(stored);
    if (profile.email === email) {
      const updated = { ...profile, isLoggedIn: true };
      localStorage.setItem(LOCAL_STORAGE_KEYS.USER, JSON.stringify(updated));
      return { userId: profile.userId, email: profile.email, displayName: profile.displayName };
    }
  }
  // No matching user — create new session (prototype behavior)
  return signUp(email, _password);
}

export function signOut(): void {
  if (typeof window === "undefined") return;
  const stored = localStorage.getItem(LOCAL_STORAGE_KEYS.USER);
  if (stored) {
    const profile: UserProfile = JSON.parse(stored);
    const updated = { ...profile, isLoggedIn: false };
    localStorage.setItem(LOCAL_STORAGE_KEYS.USER, JSON.stringify(updated));
  }
}

export function getCurrentUser(): UserProfile | null {
  if (typeof window === "undefined") return null;
  const stored = localStorage.getItem(LOCAL_STORAGE_KEYS.USER);
  if (!stored) return null;
  const profile: UserProfile = JSON.parse(stored);
  return profile.isLoggedIn ? profile : null;
}

export function isAuthenticated(): boolean {
  return getCurrentUser() !== null;
}
```

3. Create `src/hooks/useAuth.ts` — React hook that reads auth state and syncs to component:

```ts
"use client";
import { useState, useEffect, useCallback } from "react";
import { getCurrentUser, signOut as authSignOut } from "@/lib/auth";
import type { UserProfile } from "@/lib/types";

export function useAuth() {
  const [user, setUser] = useState<UserProfile | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    setUser(getCurrentUser());
    setIsLoading(false);
  }, []);

  const signOut = useCallback(() => {
    authSignOut();
    setUser(null);
  }, []);

  return {
    user,
    isLoggedIn: user !== null,
    isLoading,
    signOut,
  };
}
```
  </action>
  <verify>
Run `npm run build` — TypeScript compiles `src/lib/types.ts`, `src/lib/auth.ts`, and `src/hooks/useAuth.ts` without errors. All exports resolve.
  </verify>
  <done>UserProfile type exported. signUp, signIn, signOut, getCurrentUser, isAuthenticated functions exported from auth.ts. useAuth hook exports { user, isLoggedIn, isLoading, signOut }. TypeScript strict — no implicit any.</done>
</task>

<task type="auto">
  <name>Task 2: Auth UI — Login and Signup screens with Japandi styling, Navbar logout</name>
  <files>
    src/app/(auth)/layout.tsx
    src/app/(auth)/login/page.tsx
    src/app/(auth)/signup/page.tsx
    src/components/layout/Navbar.tsx
  </files>
  <action>
1. Create `src/app/(auth)/layout.tsx` — centered auth layout without the main Navbar (auth screens use their own minimal header):
```tsx
export default function AuthLayout({ children }: { children: React.ReactNode }) {
  return (
    <div className="min-h-screen bg-bg flex items-center justify-center px-4 py-12">
      {children}
    </div>
  );
}
```

2. Create `src/app/(auth)/login/page.tsx`:
- Page title: "Welcome back" in Cormorant Garamond (`font-display text-3xl`)
- Subtitle: "Sign in to continue exploring Mexican culture" in DM Sans text-secondary
- Email input (label: "Email") using `<Input>` component from ui/
- Password input (label: "Password") using `<Input type="password">`
- Primary "Sign in" button using `<Button variant="primary" className="w-full">`
- Divider: `<div>or</div>` with horizontal lines using border-border
- Google button: ghost variant button with Google icon placeholder (use Phosphor `Globe` icon from @phosphor-icons/react, thin weight) — disabled prop + tooltip "Available in full version"
- Apple button: same pattern with `AppleLogo` icon — disabled
- Link to /signup: "Don't have an account? Sign up"
- On form submit: call `signIn(email, password)` from @/lib/auth. On success, use `router.push("/feed")` (Next.js useRouter from "next/navigation"). On error, show inline error message in text-red-600.
- Wrap form state with useState for email, password, error, isLoading.
- The card wrapper: `max-w-sm w-full` with `<Card className="p-8">`.
- CULTX wordmark above the card: `font-display text-2xl text-text-primary text-center mb-8`

3. Create `src/app/(auth)/signup/page.tsx`:
- Same structure as login with these differences:
  - Title: "Join CULTX"
  - Subtitle: "Create your account and start exploring"
  - Additional field: "Name" (optional, placeholder "Your name")
  - Button: "Create account"
  - On submit: call `signUp(email, password, name)` from @/lib/auth, then `router.push("/onboarding/interests")`
  - Footer link: "Already have an account? Sign in" → /login

4. Update `src/components/layout/Navbar.tsx` to show a logout button when user is logged in:
```tsx
"use client";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { useAuth } from "@/hooks/useAuth";
import { Button } from "@/components/ui/Button";
import { SignOut } from "@phosphor-icons/react";

export function Navbar() {
  const { isLoggedIn, signOut } = useAuth();
  const router = useRouter();

  const handleSignOut = () => {
    signOut();
    router.push("/login");
  };

  return (
    <header className="sticky top-0 z-50 border-b border-border bg-surface/90 backdrop-blur-sm">
      <div className="mx-auto flex h-14 max-w-5xl items-center justify-between px-4">
        <Link href="/" className="font-display text-xl font-semibold tracking-wide text-text-primary">
          CULTX
        </Link>
        {isLoggedIn && (
          <Button
            variant="ghost"
            size="sm"
            onClick={handleSignOut}
            aria-label="Sign out"
            className="gap-1.5"
          >
            <SignOut size={16} weight="thin" />
            Log out
          </Button>
        )}
      </div>
    </header>
  );
}
```

Accessibility requirements (per DS-05 and claude.md):
- All form inputs have associated `<label>` elements with `htmlFor`
- All buttons have accessible text or aria-label
- Focus rings visible on all interactive elements (from globals.css :focus-visible rule)
- Disabled Google/Apple buttons have `title` attribute explaining "Available in full version"
  </action>
  <verify>
1. Run `npm run dev` — visit localhost:3000/login — login form renders with Japandi styling, no console errors.
2. Visit localhost:3000/signup — signup form renders.
3. Complete signup with test@example.com — localStorage key "cultx:user" shows isLoggedIn: true in DevTools.
4. Refresh page — user session persists (localStorage persists across refresh).
5. Click "Log out" in Navbar — redirects to /login, localStorage isLoggedIn: false.
6. Run `npm run build` — zero TypeScript errors.
  </verify>
  <done>
- /login renders login form with Cormorant Garamond heading, DM Sans body text, Washi Paper background
- /signup renders signup form with same token styling
- Signing up creates cultx:user in localStorage with isLoggedIn: true
- Signing in restores existing user session
- Signing out sets isLoggedIn: false in localStorage and redirects to /login
- Navbar shows "Log out" button with SignOut Phosphor icon when logged in
- All inputs have associated labels; focus rings visible
  </done>
</task>

</tasks>

<verification>
1. `npm run build` — zero TypeScript errors
2. localhost:3000 → redirects to /login ✓
3. /login form — submit with any email → redirect to /feed (404 expected, route not built yet) ✓
4. Refresh /feed URL → if login was performed, user stays logged in ✓
5. Navigate to /login → Navbar "Log out" button appears → click → redirected to /login, localStorage isLoggedIn: false ✓
6. /signup → "Create account" → redirects to /onboarding/interests (404 expected) ✓
7. Open DevTools > Application > localStorage > cultx:user — verify JSON shape matches UserProfile type ✓
</verification>

<success_criteria>
- AUTH-01: Signup with email works; Google/Apple buttons present as UI-only (disabled with tooltip)
- AUTH-02: Session persists across browser refresh via localStorage cultx:user key
- AUTH-03: Log out button in Navbar clears session and redirects to /login
- All auth screens pass DS-01 through DS-05: Washi Paper backgrounds, Cormorant Garamond headers, DM Sans body, sage accent buttons, Phosphor thin icons
- TypeScript strict compilation with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
